<!doctype html>
<html>
  <head>
    <title>rybl.net | Mesaprogramming</title>

    <link rel="stylesheet" href="/style/common.css" />
    <!--<link rel="stylesheet" href="/style/skylighting-espresso.css" />-->
    <link rel="stylesheet" href="/style/skylighting-solarized.css" />
    <link rel="stylesheet" href="/style/background.css" />
    <link rel="stylesheet" href="/style/custom-elements.css" />
    <link rel="stylesheet" href="/style/header-and-footer.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Spectral:ital,wght@0,200;0,300;0,400;0,500;0,600;0,700;0,800;1,200;1,300;1,400;1,500;1,600;1,700;1,800&display=swap"
      rel="stylesheet"
    />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@300..700&family=Spectral:ital,wght@0,200;0,300;0,400;0,500;0,600;0,700;0,800;1,200;1,300;1,400;1,500;1,600;1,700;1,800&display=swap"
      rel="stylesheet"
    />
    <script
      id="MathJax-script"
      async
      src="https://cdn.jsdelivr.net/npm/mathjax@4/tex-mml-chtml.js"
    ></script>

    <script src="/script/parallax-body-background-on-scroll.js"></script>

    <!--<link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.11.1/styles/tokyo-night-light.min.css"
    />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.11.1/highlight.min.js"></script>

    <script>
      hljs.highlightAll();
    </script>-->    <link rel="stylesheet" href="/style/post.css" />
  </head>
  <body>
    <svg>
      <defs>
        <filter
          id="dancing-stroke-svg-filter"
          color-interpolation-filters="linearRGB"
          filterUnits="objectBoundingBox"
          primitiveUnits="userSpaceOnUse"
        >
          <feMorphology
            operator="dilate"
            radius="4 4"
            in="SourceAlpha"
            result="morphology"
          />
          <feFlood flood-color="#30597E" flood-opacity="1" result="flood" />
          <feComposite
            in="flood"
            in2="morphology"
            operator="in"
            result="composite"
          />
          <feComposite
            in="composite"
            in2="SourceAlpha"
            operator="out"
            result="composite1"
          />
          <feTurbulence
            type="fractalNoise"
            baseFrequency="0.01 0.02"
            numOctaves="1"
            seed="0"
            stitchTiles="stitch"
            result="turbulence"
          />
          <feDisplacementMap
            in="composite1"
            in2="turbulence"
            scale="17"
            xChannelSelector="A"
            yChannelSelector="A"
            result="displacementMap"
          />
          <feMerge result="merge">
            <feMergeNode in="SourceGraphic" result="mergeNode" />
            <feMergeNode in="displacementMap" result="mergeNode1" />
          </feMerge>
        </filter>
      </defs>
    </svg>

    <div id="background"></div>
    <header><div class="title">
      <div class="root-title">
        <a href="/">rybl.net</a>
      </div>

      <img class="website-icon" src="/image/rybl-small.png" />

      <div class="local-title">Mesaprogramming</div>
    </div>
    <div class="menu">
      <div class="item">
        <a href="/">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="24"
            height="24"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="1"
            stroke-linecap="round"
            stroke-linejoin="round"
            class="icon lucide lucide-library-icon lucide-library"
          >
            <path d="m16 6 4 14" />
            <path d="M12 6v14" />
            <path d="M8 8v12" />
            <path d="M4 4v16" />
          </svg>
        </a>
      </div>
      <div class="item">
        <a href="/page/about.html">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="24"
            height="24"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="1"
            stroke-linecap="round"
            stroke-linejoin="round"
            class="icon lucide lucide-info-icon lucide-info"
          >
            <circle cx="12" cy="12" r="10" />
            <path d="M12 16v-4" />
            <path d="M12 8h.01" />
          </svg>
        </a>
      </div>
      <div class="item">
        <a href="/page/profile.html">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="20"
            height="20"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="1"
            stroke-linecap="round"
            stroke-linejoin="round"
            class="lucide lucide-globe-icon lucide-globe"
          >
            <circle cx="12" cy="12" r="10" />
            <path d="M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20" />
            <path d="M2 12h20" />
          </svg>
        </a>
      </div>
      <div class="item">
        <a href="/page/graph.html">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="24"
            height="24"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="1"
            stroke-linecap="round"
            stroke-linejoin="round"
            class="lucide lucide-orbit-icon lucide-orbit"
          >
            <path d="M20.341 6.484A10 10 0 0 1 10.266 21.85" />
            <path d="M3.659 17.516A10 10 0 0 1 13.74 2.152" />
            <circle cx="12" cy="12" r="3" />
            <circle cx="19" cy="5" r="2" />
            <circle cx="5" cy="19" r="2" />
          </svg>
        </a>
      </div>
      <div class="item">
        <a href="/page/signature.html"
          ><svg
            xmlns="http://www.w3.org/2000/svg"
            width="24"
            height="24"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="1"
            stroke-linecap="round"
            stroke-linejoin="round"
            class="lucide lucide-fingerprint-icon lucide-fingerprint"
          >
            <path d="M12 10a2 2 0 0 0-2 2c0 1.02-.1 2.51-.26 4" />
            <path d="M14 13.12c0 2.38 0 6.38-1 8.88" />
            <path d="M17.29 21.02c.12-.6.43-2.3.5-3.02" />
            <path d="M2 12a10 10 0 0 1 18-6" />
            <path d="M2 16h.01" />
            <path d="M21.8 16c.2-2 .131-5.354 0-6" />
            <path d="M5 19.5C5.5 18 6 15 6 12a6 6 0 0 1 .34-2" />
            <path d="M8.65 22c.21-.66.45-1.32.57-2" />
            <path d="M9 6.8a6 6 0 0 1 9 5.2v2" /></svg
        ></a>
      </div>
    </div></header>
    <main><h1><a href="/post/mesaprogramming.html" data-noLinkFavicon=""
data-noLinkPreview="">Mesaprogramming</a></h1>
<div class="header-info">
<p><u>Published:</u> 2021-08-24</p>
<p><u>Tags:</u> computics</p>
<p><u>Abstract</u></p>
<p>In general, metaprogramming is implemented in a type-unsafe way i.e.
it ignores type information in generated code. This is often considered
satisfactory since type-checking is still performed at compile-time, so
code generation cannot introduce new runtime errors that would be caught
at compile-time by type-checking the generated code. However, a
type-safe approach offers a much more robust way to provide expressive
metaprogramming capabilities in a way that naturally parallels the use
of the base language. For example. this approach extends naturally to
safe tactics.</p>
</div>
<div class="table-of-contents">
<p><u>Table of Contents</u></p>
<ol type="1">
<li><a href="#dependent-types" data-noLinkFavicon=""
data-noLinkPreview="">Dependent Types</a></li>
<li><a href="#metaprogramming" data-noLinkFavicon=""
data-noLinkPreview="">Metaprogramming</a></li>
<li><a href="#embedded-languages" data-noLinkFavicon=""
data-noLinkPreview="">Embedded Languages</a></li>
<li><a href="#mesaprogramming" data-noLinkFavicon=""
data-noLinkPreview="">Mesaprogramming</a></li>
<li><a href="#references" data-noLinkFavicon=""
data-noLinkPreview="">References</a></li>
<li><a href="#signature" data-noLinkFavicon=""
data-noLinkPreview="">Signature</a></li>
</ol>
</div>
<p>Whenever I write "language" I implicitly mean "programming
langauge".</p>
<h1 id="dependent-types">Dependent Types</h1>
<h1 id="metaprogramming">Metaprogramming</h1>
<p><em>Metaprogramming</em> is the design of programs that generate code
meant to be used at the same of a similarly high level of abstraction as
the metaprogram's language. For example, the popular languages Python
and Javascript each provide a built-in function called <code>eval</code>
that takes as input a string and then tries to <em>interpret</em> that
string as a piece of code in the respective language (here, "interpret"
refers to immediately executing the code a high level rather than first
<em>compiling</em> that code to a low-level representation, usually C or
Assembly).</p>
<p>Metaprogramming is the ultimate abstraction, since (almost) any
pattern of code at all can be generated by a metaprogram of the same or
smaller size (asymptotically, at the very least). However,
metaprogramming can also yield some severe side-effects.</p>
<ol>
<li>Generated code is not directly visible while programming, so there
is an additional layer of obfuscation between programming and
feedback.</li>
<li>Metaprograms usually only have limited access to static information,
which inferred by the compiler, about the programs to be generated. On
top of this, metaprograms are not usually checked to make sure they
generate valid programs. Python and Javascript's <code>eval</code>
function know that their argument is a string and nothing more!</li>
</ol>
<p>For example, Template Haskell provides a monad
<code>Q :: * -&gt; *</code> which is the type of computations that
produce Haskell code. Here is a metaprogram that, at compile-time,
generates a function that sums <code>n</code> arguments. Without
metaprogramming, there is no basic functionality for variable-arity
functions in Haskell.</p>
<div class="sourceCode" id="cb1"><pre
class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="ot">addN ::</span> <span class="dt">Int</span> <span class="ot">-&gt;</span> <span class="dt">Q</span> <span class="dt">Exp</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>addN n <span class="ot">=</span> <span class="kw">do</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>  xs <span class="ot">&lt;-</span> replicateM n (newName <span class="st">&quot;x&quot;</span>)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>  lamE (varP <span class="op">&lt;$&gt;</span> xs) (foldM (\e v <span class="ot">-&gt;</span> [<span class="op">|</span> <span class="op">$</span>e <span class="op">+</span> <span class="op">$</span>v <span class="op">|</span>]) [<span class="op">|</span> <span class="dv">0</span> <span class="op">|</span>] xs)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="ot">n ::</span> <span class="dt">Int</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>n <span class="ot">=</span> <span class="op">$</span>(addN <span class="dv">2</span>) <span class="dv">1</span> <span class="dv">2</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="co">-- n == 1 + 2</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="co">-- n == 3</span></span></code></pre></div>
<h1 id="embedded-languages">Embedded Languages</h1>
<p>The definition of a language consists of its syntax and semantics.
The <strong>syntax</strong> of a language is the specification for
well-formed programs in the language. The <strong>semantics</strong> of
a language is a mapping from it's syntax to computational behaviors.</p>
<p>Usually, the semantics of a language are represented as a function
from the syntax of a higher-level language to the syntax of a
lower-level langauge. For example, a compiled language (e.g. C++,
Haskell) has a corresponding compiler which encodes semantics with a
function, <code>compile</code>, from the language syntax to assembly
code. Then the assembly code is compiled into executable bytecode. And
finally hte executable bytecode is "compiled" into basic computational
operations. Beyond this is an descent into the physical implementation
of the computer, and further into the physical processes that make up
the physical execution.</p>
<p>Metaprogramming slighly confuses this setup, however. A metaprogram
is a program that can actually refer to the syntax of itself by
representing the program as a string, and it can refer to the semantics
of itself by calling the <code>eval</code> function. So, the hierarchy
described in the previous section can have cycles.</p>
<p>Even without metaprogramming though, we can interface directly with
this hierarchy via an embedded language. An <strong>embedded
language</strong> is a language where its syntax and semantics are
defined entirely within a higher-level language. A compiled language is
almost like an embedded language within its compiler's language, but it
is not because the compiler's language is not a (usually) a lower-level
language than the compiled language. So, embedded languages are sort of
like reverse compiled languages.</p>
<p>As a very simple example, here is a way of embedding the untyped
lambda calculus within Haskell:</p>
<div class="sourceCode" id="cb2"><pre
class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> <span class="dt">Term</span> <span class="ot">=</span> <span class="dt">Var</span> <span class="dt">String</span> <span class="op">|</span> <span class="dt">Lam</span> <span class="dt">String</span> <span class="dt">Term</span> <span class="op">|</span> <span class="dt">App</span> <span class="dt">Term</span> <span class="dt">Term</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">deriving</span> (<span class="dt">Show</span>)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="kw">type</span> <span class="dt">Ctx</span> <span class="ot">=</span> <span class="dt">String</span> <span class="ot">-&gt;</span> <span class="dt">Maybe</span> <span class="dt">Term</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="ot">eval ::</span> <span class="dt">Ctx</span> <span class="ot">-&gt;</span> <span class="dt">Term</span> <span class="ot">-&gt;</span> <span class="dt">Maybe</span> <span class="dt">Term</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>eval ctx (<span class="dt">Var</span> x) <span class="ot">=</span> ctx x</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>eval ctx (<span class="dt">Lam</span> x b) <span class="ot">=</span> <span class="dt">Just</span> (<span class="dt">Lam</span> x b)</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>eval ctx (<span class="dt">App</span> (<span class="dt">Lam</span> x b) a) <span class="ot">=</span> eval (\y <span class="ot">-&gt;</span> <span class="kw">if</span> x <span class="op">==</span> y <span class="kw">then</span> b <span class="kw">else</span> ctx y) b</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>eval ctx (<span class="dt">App</span> _ _) <span class="ot">=</span> <span class="dt">Nothing</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a><span class="ot">example1 ::</span> <span class="dt">Maybe</span> <span class="dt">Term</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>example1 <span class="ot">=</span> eval (\_ <span class="ot">-&gt;</span> <span class="dt">Nothing</span>) (<span class="dt">App</span> (<span class="dt">Lam</span> <span class="st">&quot;x&quot;</span> (<span class="dt">Var</span> <span class="st">&quot;x&quot;</span>)) (<span class="dt">Var</span> <span class="st">&quot;y&quot;</span>))</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a><span class="co">-- example1 = eval ((λ x . x) y)</span></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a><span class="co">-- example1 == Just (Var &quot;y&quot;)</span></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a><span class="ot">example2 ::</span> <span class="dt">Maybe</span> <span class="dt">Term</span></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>example2 <span class="ot">=</span> eval (\_ <span class="ot">-&gt;</span> <span class="dt">Nothing</span>) (<span class="dt">App</span> (<span class="dt">Var</span> <span class="st">&quot;x&quot;</span>) (<span class="dt">Var</span> <span class="st">&quot;y&quot;</span>))</span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a><span class="co">-- example2 = eval (x y)</span></span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a><span class="co">-- example2 == Nothing</span></span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a><span class="ot">example3 ::</span> <span class="dt">Maybe</span> <span class="dt">Term</span></span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>example3 <span class="ot">=</span> eval (\_ <span class="ot">-&gt;</span> <span class="dt">Nothing</span>) (<span class="dt">App</span> (<span class="dt">Lam</span> <span class="st">&quot;x&quot;</span> (<span class="dt">Var</span> <span class="st">&quot;y&quot;</span>)) (<span class="dt">Var</span> <span class="st">&quot;z&quot;</span>))</span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a><span class="co">-- example3 = eval ((λ x . y) z)</span></span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a><span class="co">-- example3 == Nothing</span></span></code></pre></div>
<p>The datatype <code>Term</code> defined the syntax of the language,
and the function <code>eval</code> defined the syntax of the language.
Note that, since <code>eval</code> returns a <code>Maybe Term</code>, it
can be considered partial on the entire syntax domain. That is, some
syntactically-valid programs are not meaningful i.e. they don't have
semantics. For example, <code>example2</code> tries to apply a
non-lambda, and <code>example3</code> refers to an unbound variable.</p>
<p>So, what's the point of embedded languages? Two interesting use cases
are the following:</p>
<ol>
<li>A language (or, at least, parts of it) can be embedded within itself
to facilitate metaprogramming capabilities. Rather than just attempt to
parse unstrucutred strings like JavaScript and Python's
<code>eval</code>, languages like Haskell (via <span><a
href="https://wiki.haskell.org/Template_Haskell"><img src="/missing.ico"
class="favicon" alt="/missing.ico" />Template Haskell</a><span
class="sidenote preview"><span class="preview-title"><em><a
href="https://wiki.haskell.org/Template_Haskell" title="_blank"><img
src="/missing.ico" class="favicon"
alt="/missing.ico" />https://wiki.haskell.org/Dependent_type</a></em></span><span
class="preview-description">Placeholder description for
https://wiki.haskell.org/Dependent_type</span></span></span>) and C++
(via <span><a
href="https://docs.microsoft.com/en-us/cpp/cpp/templates-cpp"><img
src="/favicon/microsoft.com.ico" class="favicon"
alt="/favicon/microsoft.com.ico" />templates</a><span
class="sidenote preview"><span class="preview-title"><em><a
href="https://docs.microsoft.com/en-us/cpp/cpp/templates-cpp"
title="_blank"><img src="/favicon/microsoft.com.ico" class="favicon"
alt="/favicon/microsoft.com.ico" />https://docs.microsoft.com/en-us/cpp/cpp/templates-cpp</a></em></span><span
class="preview-description">Placeholder description for
https://docs.microsoft.com/en-us/cpp/cpp/templates-cpp</span></span></span>)
offer a metaprogramming interface for manipulate structured
representations of the language's syntax. This makes writing and
reasoning about metaprograms somewhat easier.</li>
<li>A language of interest can be embedded within a proof assistant
language, such as Agda or Coq, in order for the programmer to write
proofs about the syntax and semantics of programs in the embedded
language. This is useful for verifying properties of important programs
in the embedded language, such as <span><a
href="https://compcert.org"><img src="/missing.ico" class="favicon"
alt="/missing.ico" />compilers</a><span class="sidenote preview"><span
class="preview-title"><em><a href="https://compcert.org"
title="_blank"><img src="/missing.ico" class="favicon"
alt="/missing.ico" />https://compcert.org</a></em></span><span
class="preview-description">Placeholder description for
https://compcert.org</span></span></span>.</li>
</ol>
<p>In the following section, I will introduce another use case,
mesaprogramming, which is a combination of these two use cases.</p>
<h1 id="mesaprogramming">Mesaprogramming</h1>
<p>The usual technique of metaprogramming ("above-programming") is to
provide a special interface for invoking code generation (e.g. templates
as a built-in or library feature). The main issue with this is that it
requires a new metaprogramming language to be built on top of the base
language, which comes with complicated language features and usually
little to none of the safety features of the original language. This is
a serious issue because writing correct metaprograms is very difficult,
especially when their output is not easily accessible.</p>
<p><strong>Mesaprogramming</strong> ("below-programming") is an
alternative technique that can be implemented in any language, and is
most powerful in proof assistant languages. Rather than write a
metaprogramming language <em>on top</em> of the base language, the
technique of mesaprogramming is to define an embedded mesaprogramming
language <em>inside of</em> the base language as a formalization of a
fragment of the base language (defining the entire language within
itself comes with many issues: TODO).</p>
<p>For example, variable arity functions in Haskell:</p>
<div class="sourceCode" id="cb3"><pre
class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="ot">{-# LANGUAGE DataKinds #-}</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="ot">{-# LANGUAGE GADTs #-}</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="ot">{-# LANGUAGE KindSignatures #-}</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="ot">{-# LANGUAGE RankNTypes #-}</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="ot">{-# LANGUAGE TypeFamilies #-}</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> <span class="dt">Nat</span> <span class="ot">=</span> <span class="dt">Zero</span> <span class="op">|</span> <span class="dt">Suc</span> <span class="dt">Nat</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> <span class="dt">SNat</span><span class="ot"> ::</span> <span class="dt">Nat</span> <span class="ot">-&gt;</span> <span class="op">*</span> <span class="kw">where</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>  <span class="dt">SZero</span><span class="ot"> ::</span> <span class="dt">SNat</span> <span class="dt">Zero</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>  <span class="dt">SSuc</span><span class="ot"> ::</span> <span class="dt">SNat</span> n <span class="ot">-&gt;</span> <span class="dt">SNat</span> (<span class="dt">Suc</span> n)</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a><span class="ot">n0 ::</span> <span class="dt">SNat</span> <span class="dt">Zero</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>n0 <span class="ot">=</span> <span class="dt">SZero</span></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a><span class="ot">n1 ::</span> <span class="dt">SNat</span> (<span class="dt">Suc</span> <span class="dt">Zero</span>)</span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>n1 <span class="ot">=</span> <span class="dt">SSuc</span> <span class="dt">SZero</span></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a><span class="ot">n2 ::</span> <span class="dt">SNat</span> (<span class="dt">Suc</span> (<span class="dt">Suc</span> <span class="dt">Zero</span>))</span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>n2 <span class="ot">=</span> <span class="dt">SSuc</span> (<span class="dt">SSuc</span> <span class="dt">SZero</span>)</span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a><span class="ot">n3 ::</span> <span class="dt">SNat</span> (<span class="dt">Suc</span> (<span class="dt">Suc</span> (<span class="dt">Suc</span> <span class="dt">Zero</span>)))</span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>n3 <span class="ot">=</span> <span class="dt">SSuc</span> (<span class="dt">SSuc</span> (<span class="dt">SSuc</span> <span class="dt">SZero</span>))</span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a><span class="kw">type</span> <span class="kw">family</span> <span class="dt">EndoN</span> (<span class="ot">a ::</span> <span class="op">*</span>) (<span class="ot">n ::</span> <span class="dt">Nat</span>)<span class="ot"> ::</span> <span class="op">*</span> <span class="kw">where</span></span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>  <span class="dt">EndoN</span> a <span class="dt">Zero</span> <span class="ot">=</span> a</span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>  <span class="dt">EndoN</span> a (<span class="dt">Suc</span> n) <span class="ot">=</span> a <span class="ot">-&gt;</span> <span class="dt">EndoN</span> a n</span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a><span class="co">-- given a (singleton for) natural number `n`, is an `n`-ary function that adds its inputs</span></span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a><span class="ot">addN ::</span> <span class="dt">SNat</span> n <span class="ot">-&gt;</span> <span class="dt">EndoN</span> <span class="dt">Int</span> n</span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a>addN <span class="dt">SZero</span> <span class="ot">=</span> <span class="dv">0</span></span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a>addN (<span class="dt">SSuc</span> <span class="dt">SZero</span>) <span class="ot">=</span> \x <span class="ot">-&gt;</span> x</span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a>addN (<span class="dt">SSuc</span> (<span class="dt">SSuc</span> n)) <span class="ot">=</span> \x y <span class="ot">-&gt;</span> addN (<span class="dt">SSuc</span> n) (x <span class="op">+</span> y)</span></code></pre></div>
<p>For example, TODO: example of metaprogramming in python</p>
<div class="sourceCode" id="cb4"><pre
class="sourceCode python"><code class="sourceCode python"></code></pre></div>
<h1 id="references">References</h1>
<ul>
<li><a href="https://wiki.haskell.org/Template_Haskell"
data-inReference="" data-noLinkPreview=""><img src="/missing.ico"
class="favicon" alt="/missing.ico" />Template Haskell</a></li>
<li><a href="https://docs.microsoft.com/en-us/cpp/cpp/templates-cpp"
data-inReference="" data-noLinkPreview=""><img
src="/favicon/microsoft.com.ico" class="favicon"
alt="/favicon/microsoft.com.ico" />templates</a></li>
<li><a href="https://compcert.org" data-inReference=""
data-noLinkPreview=""><img src="/missing.ico" class="favicon"
alt="/missing.ico" />compilers</a></li>
</ul>
<h1 id="signature">Signature</h1>
<p>The following code block is the <a
href="https://en.wikipedia.org/wiki/EdDSA#Ed25519" title="_blank"><img
src="/favicon/wikipedia.org.ico" class="favicon"
alt="/favicon/wikipedia.org.ico" />Ed25519 signature</a> of this post's
<a href="/post_markdown/mesaprogramming.md"><img src="/favicon.ico"
class="favicon" alt="/favicon.ico" />markdown content</a> encoded in
base 64, using my <em>secret key</em> and <a
href="/key/main_ed25519.pub.txt" title="_blank"><img src="/favicon.ico"
class="favicon" alt="/favicon.ico" />public key</a>.</p>
<pre><code>f973d8a6dc4bf91fa9f34a7ff12e1a5005aff4336f985491bdebc3b2177a9592e5a84a4aac48252ba439dcf16502d2d0d464262c46f41edc8e768bf9783e620c</code></pre>
<p>See <a href="/page/signature.html"><img src="/favicon.ico"
class="favicon" alt="/favicon.ico" />Signature</a> for more
information.</p></main>

    <footer>
      <div class="title">
        <div class="root-title">
          <a href="/">rybl.net</a>
        </div>

        <img class="website-icon" src="/image/rybl-small.png" />

        <div class="local-title">Mesaprogramming</div>
      </div>
      <div class="menu">
        <div class="item">
          <a href="/">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="24"
              height="24"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="1"
              stroke-linecap="round"
              stroke-linejoin="round"
              class="icon lucide lucide-library-icon lucide-library"
            >
              <path d="m16 6 4 14" />
              <path d="M12 6v14" />
              <path d="M8 8v12" />
              <path d="M4 4v16" />
            </svg>
          </a>
        </div>
        <div class="item">
          <a href="/page/about.html">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="24"
              height="24"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="1"
              stroke-linecap="round"
              stroke-linejoin="round"
              class="icon lucide lucide-info-icon lucide-info"
            >
              <circle cx="12" cy="12" r="10" />
              <path d="M12 16v-4" />
              <path d="M12 8h.01" />
            </svg>
          </a>
        </div>
        <div class="item">
          <a href="/page/profile.html">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="20"
              height="20"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="1"
              stroke-linecap="round"
              stroke-linejoin="round"
              class="lucide lucide-globe-icon lucide-globe"
            >
              <circle cx="12" cy="12" r="10" />
              <path d="M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20" />
              <path d="M2 12h20" />
            </svg>
          </a>
        </div>
        <div class="item">
          <a href="/page/graph.html">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="24"
              height="24"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="1"
              stroke-linecap="round"
              stroke-linejoin="round"
              class="lucide lucide-orbit-icon lucide-orbit"
            >
              <path d="M20.341 6.484A10 10 0 0 1 10.266 21.85" />
              <path d="M3.659 17.516A10 10 0 0 1 13.74 2.152" />
              <circle cx="12" cy="12" r="3" />
              <circle cx="19" cy="5" r="2" />
              <circle cx="5" cy="19" r="2" />
            </svg>
          </a>
        </div>
        <div class="item">
          <a href="/page/signature.html"
            ><svg
              xmlns="http://www.w3.org/2000/svg"
              width="24"
              height="24"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="1"
              stroke-linecap="round"
              stroke-linejoin="round"
              class="lucide lucide-fingerprint-icon lucide-fingerprint"
            >
              <path d="M12 10a2 2 0 0 0-2 2c0 1.02-.1 2.51-.26 4" />
              <path d="M14 13.12c0 2.38 0 6.38-1 8.88" />
              <path d="M17.29 21.02c.12-.6.43-2.3.5-3.02" />
              <path d="M2 12a10 10 0 0 1 18-6" />
              <path d="M2 16h.01" />
              <path d="M21.8 16c.2-2 .131-5.354 0-6" />
              <path d="M5 19.5C5.5 18 6 15 6 12a6 6 0 0 1 .34-2" />
              <path d="M8.65 22c.21-.66.45-1.32.57-2" />
              <path d="M9 6.8a6 6 0 0 1 9 5.2v2" /></svg
          ></a>
        </div>
      </div></footer>  </body>
</html>
