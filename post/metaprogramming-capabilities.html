<!doctype html>
<html>
  <head>
    <title>rybl.net | Metaprogramming Capabilities</title>

    <link rel="stylesheet" href="/style/common.css" />
    <!--<link rel="stylesheet" href="/style/skylighting-espresso.css" />-->
    <link rel="stylesheet" href="/style/skylighting-solarized.css" />
    <link rel="stylesheet" href="/style/background.css" />
    <link rel="stylesheet" href="/style/custom-elements.css" />
    <link rel="stylesheet" href="/style/header-and-footer.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Spectral:ital,wght@0,200;0,300;0,400;0,500;0,600;0,700;0,800;1,200;1,300;1,400;1,500;1,600;1,700;1,800&display=swap"
      rel="stylesheet"
    />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@300..700&family=Spectral:ital,wght@0,200;0,300;0,400;0,500;0,600;0,700;0,800;1,200;1,300;1,400;1,500;1,600;1,700;1,800&display=swap"
      rel="stylesheet"
    />
    <script
      id="MathJax-script"
      async
      src="https://cdn.jsdelivr.net/npm/mathjax@4/tex-mml-chtml.js"
    ></script>

    <script src="/script/parallax-body-background-on-scroll.js"></script>

    <!--<link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.11.1/styles/tokyo-night-light.min.css"
    />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.11.1/highlight.min.js"></script>

    <script>
      hljs.highlightAll();
    </script>-->    <link rel="stylesheet" href="/style/post.css" />
  </head>
  <body>
    <svg>
      <defs>
        <filter
          id="dancing-stroke-svg-filter"
          color-interpolation-filters="linearRGB"
          filterUnits="objectBoundingBox"
          primitiveUnits="userSpaceOnUse"
        >
          <feMorphology
            operator="dilate"
            radius="4 4"
            in="SourceAlpha"
            result="morphology"
          />
          <feFlood flood-color="#30597E" flood-opacity="1" result="flood" />
          <feComposite
            in="flood"
            in2="morphology"
            operator="in"
            result="composite"
          />
          <feComposite
            in="composite"
            in2="SourceAlpha"
            operator="out"
            result="composite1"
          />
          <feTurbulence
            type="fractalNoise"
            baseFrequency="0.01 0.02"
            numOctaves="1"
            seed="0"
            stitchTiles="stitch"
            result="turbulence"
          />
          <feDisplacementMap
            in="composite1"
            in2="turbulence"
            scale="17"
            xChannelSelector="A"
            yChannelSelector="A"
            result="displacementMap"
          />
          <feMerge result="merge">
            <feMergeNode in="SourceGraphic" result="mergeNode" />
            <feMergeNode in="displacementMap" result="mergeNode1" />
          </feMerge>
        </filter>
      </defs>
    </svg>

    <div id="background"></div>
    <header><div class="title">
      <div class="root-title">
        <a href="/">rybl.net</a>
      </div>

      <img class="website-icon" src="/image/rybl-small.png" />

      <div class="local-title">Metaprogramming Capabilities</div>
    </div>
    <div class="menu">
      <div class="item">
        <a href="/">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="24"
            height="24"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="1"
            stroke-linecap="round"
            stroke-linejoin="round"
            class="icon lucide lucide-library-icon lucide-library"
          >
            <path d="m16 6 4 14" />
            <path d="M12 6v14" />
            <path d="M8 8v12" />
            <path d="M4 4v16" />
          </svg>
        </a>
      </div>
      <div class="item">
        <a href="/page/about.html">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="24"
            height="24"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="1"
            stroke-linecap="round"
            stroke-linejoin="round"
            class="icon lucide lucide-info-icon lucide-info"
          >
            <circle cx="12" cy="12" r="10" />
            <path d="M12 16v-4" />
            <path d="M12 8h.01" />
          </svg>
        </a>
      </div>
      <div class="item">
        <a href="/page/profile.html">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="20"
            height="20"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="1"
            stroke-linecap="round"
            stroke-linejoin="round"
            class="lucide lucide-globe-icon lucide-globe"
          >
            <circle cx="12" cy="12" r="10" />
            <path d="M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20" />
            <path d="M2 12h20" />
          </svg>
        </a>
      </div>
      <div class="item">
        <a href="/page/graph.html">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="24"
            height="24"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="1"
            stroke-linecap="round"
            stroke-linejoin="round"
            class="lucide lucide-orbit-icon lucide-orbit"
          >
            <path d="M20.341 6.484A10 10 0 0 1 10.266 21.85" />
            <path d="M3.659 17.516A10 10 0 0 1 13.74 2.152" />
            <circle cx="12" cy="12" r="3" />
            <circle cx="19" cy="5" r="2" />
            <circle cx="5" cy="19" r="2" />
          </svg>
        </a>
      </div>
      <div class="item">
        <a href="/page/signature.html"
          ><svg
            xmlns="http://www.w3.org/2000/svg"
            width="24"
            height="24"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="1"
            stroke-linecap="round"
            stroke-linejoin="round"
            class="lucide lucide-fingerprint-icon lucide-fingerprint"
          >
            <path d="M12 10a2 2 0 0 0-2 2c0 1.02-.1 2.51-.26 4" />
            <path d="M14 13.12c0 2.38 0 6.38-1 8.88" />
            <path d="M17.29 21.02c.12-.6.43-2.3.5-3.02" />
            <path d="M2 12a10 10 0 0 1 18-6" />
            <path d="M2 16h.01" />
            <path d="M21.8 16c.2-2 .131-5.354 0-6" />
            <path d="M5 19.5C5.5 18 6 15 6 12a6 6 0 0 1 .34-2" />
            <path d="M8.65 22c.21-.66.45-1.32.57-2" />
            <path d="M9 6.8a6 6 0 0 1 9 5.2v2" /></svg
        ></a>
      </div>
    </div></header>
    <main><h1><a href="/post/metaprogramming-capabilities.html"
class="no-link-favicon no-link-preview">Metaprogramming
Capabilities</a></h1>
<div>
<div class="sidenote persistent header-info">
<p><u>Published:</u> 2022-09-27</p>
<p><u>Tags:</u> computics, Haskell</p>
<p><u>Abstract</u></p>
<p>An overview of different capabilities and styles of
metaprogramming.</p>
</div>
</div>
<div>
<div class="sidenote persistent table-of-contents">
<p><u>Table of Contents</u></p>
<ol type="1">
<li><a href="#overview"
class="no-link-favicon no-link-preview">Overview</a></li>
<li><a href="#macros"
class="no-link-favicon no-link-preview">Macros</a></li>
<li><a href="#signature"
class="no-link-favicon no-link-preview">Signature</a></li>
</ol>
</div>
</div>
<h2 id="overview">§ <a href="#overview"
class="no-link-favicon no-link-preview">Overview</a></h2>
<p>A <em>metaprogram</em> is a program that operates on the syntax of a
programming language as data. Many advanced programming languages
provide some sort of metaprogramming capabilities, for example: -
Haskell - <em>templates</em> (<em>TemplateHaskell</em>): splice syntax -
<em>type classes</em>: splice function definitions - Agda -
<em>reflection</em>: inspect syntax - <em>macros</em>: splice syntax -
<em>syntax notations</em>: splice syntax - Coq - <em>reflection</em> and
<em>templates</em> (<em>Template-Coq</em> via <em>MetaCoq</em>): inspect
syntax, splice syntax - <em>notations</em>: splice syntax -
<em>tactics</em>: splice terms, match on context - Lean -
<em>macros</em>: splice syntax - <em>notations</em>: splice syntax -
<em>tactics</em>: splice terms, match on context - Rust -
<em>macros</em>: splice syntax - C++ - <em>templates</em>: splice
function and class definitions (used for polymorphism) -
<em>macros</em>: splice text - Python - <em>meta classes</em>: splice
classes - <em>eval</em>: interpret syntax - JavaScript -
<em>proxies</em>: intercept semantics - <em>reflection</em>: inspect
syntax - <em>eval</em>: interpret syntax</p>
<p>Overall, I group these capabilities into the following tags: -
<em>Reflection</em> — inspect syntax. Examples: reflection, eval. -
<em>Reification</em> — splice syntax. Examples: macros, templates,
Haskell type classes, Python meta classes. - <em>Dynamic semantics</em>
— modify semantics. Examples: JavaScript proxies.</p>
<h2 id="macros">§ <a href="#macros"
class="no-link-favicon no-link-preview">Macros</a></h2>
<p>Macros are common style of reification — splicing syntax. Generally,
a language with macros provides a special syntax for defining macro
functions, which are functions that are run at compile time and output
syntax that is spliced as the call cite before the rest of compilation.
These functions are written using the same language that the macros
expand to, with a few extra operations relevant to reification.</p>
<p>So far, macros sound just like general reification. But, general
reification is very difficult. With the freedom to work over your
program as generally as just a string, you lose of lot of the safety
features that many languages try to provide, such as well-typeness,
well-scoped news, well-formedness, etc. If you wrote the program you
intend to splice directly, the compiler/interpreter can immediately tell
you where things went wrong: type errors, scoping errors, syntax errors,
etc. But if you compiler your metaprogram, the system cannot statically
predict if the metaprogram will certainly produce well-typed,
well-scoped, well-formed text where it is spliced. Each use of the
metaprogram has to be checked itself, and so in essence the user only
has dynamic guarantees about the behavior of the metaprogram (since
run-time for the metaprogram is compile-time for the base program).</p>
<p>Macros and templates are different approaches to solving this problem
— that is, the problem of checking static guarantees of reification
metaprograms.</p>
<p><em>Templates</em> use a deep embedding of the language (encoding the
entire syntactical structure of the base language as data in the base
language available to work over by the macro) to ensure that the
generated text necessarily reifies as well-formed, well-scoped, or
perhaps even well-typed syntax. This is a very restrictive form of
metaprogramming, because it doesn’t allow for the generation of several
textual components that can be combined in some way to refit as good
syntax. For example: - Template Haskell has typed template
metaprogramming, where an expression of type <code>Q a</code> is able to
be reified into a term of type <code>a</code>. - C++ class/function
templates require a specific form which ensures that the generated
classes/functions are well-formed.</p>
<p><em>Macros</em> use a partially-parsed version of the language’s
syntax as an intermediate representation to work over. So, the macro is
required to work over expressions in this partial-parsed syntax (as
opposed to unstructured text or fully well-formed syntax) that doesn’t
necessarily require all of the same checks as for the base language
(such as well-typedness or well-scopedness). In this way, the macro can
still have some basic statically-checked properties, such as producing
matching delimiters, well-scoped names, etc.</p>
<h2 id="signature">§ <a href="#signature"
class="no-link-favicon no-link-preview">Signature</a></h2>
<p>The following code block is the <a
href="https://en.wikipedia.org/wiki/EdDSA#Ed25519" title="_blank"><img
src="/favicon/wikipedia.org.ico" class="favicon"
alt="/favicon/wikipedia.org.ico" />Ed25519 signature</a> of this post's
<a href="/post_markdown/metaprogramming-capabilities.md"><img
src="/favicon.ico" class="favicon" alt="/favicon.ico" />markdown
content</a> encoded in base 64, using my <em>secret key</em> and <a
href="/key/main_ed25519.pub.txt" title="_blank"><img src="/favicon.ico"
class="favicon" alt="/favicon.ico" />public key</a>.</p>
<div class="sourceCode" id="cb1"><pre
class="sourceCode txt"><code class="sourceCode default"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>938239d4518be854da9e1a3c93ad4e97243293b02107647fadb74cb545d49be2c05c989ac02803bd6dec621231f9af1b85d71839bf0235d9d2e62116959f670b</span></code></pre></div>
<p>See <a href="/page/signature.html"><img src="/favicon.ico"
class="favicon" alt="/favicon.ico" />Signature</a> for more
information.</p></main>

    <footer>
      <div class="title">
        <div class="root-title">
          <a href="/">rybl.net</a>
        </div>

        <img class="website-icon" src="/image/rybl-small.png" />

        <div class="local-title">Metaprogramming Capabilities</div>
      </div>
      <div class="menu">
        <div class="item">
          <a href="/">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="24"
              height="24"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="1"
              stroke-linecap="round"
              stroke-linejoin="round"
              class="icon lucide lucide-library-icon lucide-library"
            >
              <path d="m16 6 4 14" />
              <path d="M12 6v14" />
              <path d="M8 8v12" />
              <path d="M4 4v16" />
            </svg>
          </a>
        </div>
        <div class="item">
          <a href="/page/about.html">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="24"
              height="24"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="1"
              stroke-linecap="round"
              stroke-linejoin="round"
              class="icon lucide lucide-info-icon lucide-info"
            >
              <circle cx="12" cy="12" r="10" />
              <path d="M12 16v-4" />
              <path d="M12 8h.01" />
            </svg>
          </a>
        </div>
        <div class="item">
          <a href="/page/profile.html">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="20"
              height="20"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="1"
              stroke-linecap="round"
              stroke-linejoin="round"
              class="lucide lucide-globe-icon lucide-globe"
            >
              <circle cx="12" cy="12" r="10" />
              <path d="M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20" />
              <path d="M2 12h20" />
            </svg>
          </a>
        </div>
        <div class="item">
          <a href="/page/graph.html">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="24"
              height="24"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="1"
              stroke-linecap="round"
              stroke-linejoin="round"
              class="lucide lucide-orbit-icon lucide-orbit"
            >
              <path d="M20.341 6.484A10 10 0 0 1 10.266 21.85" />
              <path d="M3.659 17.516A10 10 0 0 1 13.74 2.152" />
              <circle cx="12" cy="12" r="3" />
              <circle cx="19" cy="5" r="2" />
              <circle cx="5" cy="19" r="2" />
            </svg>
          </a>
        </div>
        <div class="item">
          <a href="/page/signature.html"
            ><svg
              xmlns="http://www.w3.org/2000/svg"
              width="24"
              height="24"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="1"
              stroke-linecap="round"
              stroke-linejoin="round"
              class="lucide lucide-fingerprint-icon lucide-fingerprint"
            >
              <path d="M12 10a2 2 0 0 0-2 2c0 1.02-.1 2.51-.26 4" />
              <path d="M14 13.12c0 2.38 0 6.38-1 8.88" />
              <path d="M17.29 21.02c.12-.6.43-2.3.5-3.02" />
              <path d="M2 12a10 10 0 0 1 18-6" />
              <path d="M2 16h.01" />
              <path d="M21.8 16c.2-2 .131-5.354 0-6" />
              <path d="M5 19.5C5.5 18 6 15 6 12a6 6 0 0 1 .34-2" />
              <path d="M8.65 22c.21-.66.45-1.32.57-2" />
              <path d="M9 6.8a6 6 0 0 1 9 5.2v2" /></svg
          ></a>
        </div>
      </div></footer>  </body>
</html>
